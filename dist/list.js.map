{"version":3,"file":"list.js","sources":["../src/index.js"],"sourcesContent":["var naturalSort = require('string-natural-compare'),\n  getByClass = require('./utils/get-by-class'),\n  extend = require('./utils/extend'),\n  indexOf = require('./utils/index-of'),\n  events = require('./utils/events'),\n  toString = require('./utils/to-string'),\n  classes = require('./utils/classes'),\n  getAttribute = require('./utils/get-attribute'),\n  toArray = require('./utils/to-array'),\n  templater = require('./templater'),\n  Item = require('./item'),\n  sort = require('./sort'),\n  sortButtons = require('./sort-buttons')\n\nvar addSortListeners = sortButtons.addSortListeners\nvar clearSortOrder = sortButtons.clearSortOrder\nvar setSortOrder = sortButtons.setSortOrder\n\nmodule.exports = function (id, options, values) {\n  var self = this,\n    init,\n    addAsync = require('./add-async')(self),\n    initPagination = require('./pagination')(self)\n\n  init = {\n    start: function () {\n      self.listClass = 'list'\n      self.searchClass = 'search'\n      self.sortClass = 'sort'\n      self.page = 10000\n      self.i = 1\n      self.items = []\n      self.visibleItems = []\n      self.matchingItems = []\n      self.searched = false\n      self.filtered = false\n      self.searchColumns = undefined\n      self.searchDelay = 0\n      self.handlers = { updated: [] }\n      self.valueNames = []\n      self.utils = {\n        getByClass: getByClass,\n        extend: extend,\n        indexOf: indexOf,\n        events: events,\n        toString: toString,\n        naturalSort: naturalSort,\n        classes: classes,\n        getAttribute: getAttribute,\n        toArray: toArray,\n      }\n\n      self.utils.extend(self, options)\n\n      self.listContainer = typeof id === 'string' ? document.getElementById(id) : id\n      if (!self.listContainer) {\n        return\n      }\n      self.list = getByClass(self.listContainer, self.listClass, true)\n\n      self.parse = require('./parse')(self)\n      self.templater = templater\n      self.template = self.templater.getTemplate({\n        parentEl: self.list,\n        valueNames: self.valueNames,\n        template: self.item,\n      })\n      self.search = require('./search')(self)\n      self.filter = require('./filter')(self)\n      self.fuzzySearch = require('./fuzzy-search')(self, options.fuzzySearch)\n\n      this.handlers()\n      this.items()\n      this.pagination()\n      this.sort()\n\n      self.update()\n    },\n    handlers: function () {\n      for (var handler in self.handlers) {\n        if (self[handler] && self.handlers[handler]) {\n          self.on(handler, self[handler])\n        }\n      }\n    },\n    items: function () {\n      self.parse(self.list)\n      if (values !== undefined) {\n        self.add(values)\n      }\n    },\n    pagination: function () {\n      if (options.pagination !== undefined) {\n        if (options.pagination === true) {\n          options.pagination = [{}]\n        }\n        if (options.pagination[0] === undefined) {\n          options.pagination = [options.pagination]\n        }\n        for (var i = 0, il = options.pagination.length; i < il; i++) {\n          initPagination(options.pagination[i])\n        }\n      }\n    },\n    sort: function () {\n      var sortButtons = self.utils.getByClass(self.listContainer, self.sortClass)\n      var items = self.items\n      var sortFunction = self.sortFunction\n      var alphabet = self.alphabet\n      var before = function () {\n        self.trigger('sortStart')\n      }\n      var after = function () {\n        self.update()\n        self.trigger('sortComplete')\n      }\n      addSortListeners(sortButtons, {\n        items: items,\n        sortFunction: sortFunction,\n        alphabet: alphabet,\n        before: before,\n        after: after,\n      })\n\n      self.handlers.sortStart = self.handlers.sortStart || []\n      self.handlers.sortComplete = self.handlers.sortComplete || []\n      self.on('searchStart', function () {\n        clearSortOrder(sortButtons)\n      })\n      self.on('filterStart', function () {\n        clearSortOrder(sortButtons)\n      })\n      self.sort = function (valueName, options) {\n        options = options || {}\n        before()\n        setSortOrder(sortButtons, valueName, options.order)\n        options.alphabet = options.alphabet || self.alphabet\n        options.sortFunction = options.sortFunction || self.sortFunction\n        options.valueName = valueName\n        sort(items, valueName, options)\n        after()\n        return items\n      }\n    },\n  }\n\n  /*\n   * Re-parse the List, use if html have changed\n   */\n  this.reIndex = function () {\n    self.items = []\n    self.visibleItems = []\n    self.matchingItems = []\n    self.searched = false\n    self.filtered = false\n    self.parse(self.list)\n  }\n\n  this.toJSON = function () {\n    var json = []\n    for (var i = 0, il = self.items.length; i < il; i++) {\n      json.push(self.items[i].values())\n    }\n    return json\n  }\n\n  /*\n   * Add object to list\n   */\n  this.add = function (values, callback) {\n    if (values.length === 0) {\n      return\n    }\n    if (callback) {\n      addAsync(values.slice(0), callback)\n      return\n    }\n    var added = []\n    if (values[0] === undefined) {\n      values = [values]\n    }\n    for (var i = 0, il = values.length; i < il; i++) {\n      var item = new Item(values[i], { template: self.template })\n      self.items.push(item)\n      added.push(item)\n    }\n    self.update()\n    return added\n  }\n\n  this.show = function (i, page) {\n    this.i = i\n    this.page = page\n    self.update()\n    return self\n  }\n\n  /* Removes object from list.\n   * Loops through the list and removes objects where\n   * property \"valuename\" === value\n   */\n  this.remove = function (valueName, value) {\n    var found = 0\n    for (var i = 0, il = self.items.length; i < il; i++) {\n      if (self.items[i].values()[valueName] == value) {\n        self.templater.remove(self.items[i].elm, self.list)\n        self.items.splice(i, 1)\n        il--\n        i--\n        found++\n      }\n    }\n    self.update()\n    return found\n  }\n\n  /* Gets the objects in the list which\n   * property \"valueName\" === value\n   */\n  this.get = function (valueName, value) {\n    var matchedItems = []\n    for (var i = 0, il = self.items.length; i < il; i++) {\n      var item = self.items[i]\n      if (item.values()[valueName] == value) {\n        matchedItems.push(item)\n      }\n    }\n    return matchedItems\n  }\n\n  /*\n   * Get size of the list\n   */\n  this.size = function () {\n    return self.items.length\n  }\n\n  /*\n   * Removes all items from the list\n   */\n  this.clear = function () {\n    self.templater.clear(self.list)\n    self.items = []\n    return self\n  }\n\n  this.on = function (event, callback) {\n    self.handlers[event].push(callback)\n    return self\n  }\n\n  this.off = function (event, callback) {\n    var e = self.handlers[event]\n    var index = indexOf(e, callback)\n    if (index > -1) {\n      e.splice(index, 1)\n    }\n    return self\n  }\n\n  this.trigger = function (event) {\n    var i = self.handlers[event].length\n    while (i--) {\n      self.handlers[event][i](self)\n    }\n    return self\n  }\n\n  this.reset = {\n    filter: function () {\n      var is = self.items,\n        il = is.length\n      while (il--) {\n        is[il].filtered = false\n      }\n      return self\n    },\n    search: function () {\n      var is = self.items,\n        il = is.length\n      while (il--) {\n        is[il].found = false\n      }\n      return self\n    },\n  }\n\n  this.update = function () {\n    var is = self.items,\n      il = is.length\n\n    self.visibleItems = []\n    self.matchingItems = []\n    self.templater.clear(self.list)\n    for (var i = 0; i < il; i++) {\n      if (is[i].matching(self) && self.matchingItems.length + 1 >= self.i && self.visibleItems.length < self.page) {\n        if (!is[i].elm) {\n          is[i].elm = templater.create(is[i].values(), self.template)\n        }\n        templater.show(is[i].elm, self.list)\n        self.visibleItems.push(is[i])\n        self.matchingItems.push(is[i])\n      } else if (is[i].matching(self)) {\n        self.matchingItems.push(is[i])\n        templater.remove(is[i].elm, self.list)\n      } else {\n        templater.remove(is[i].elm, self.list)\n      }\n    }\n    self.trigger('updated')\n    return self\n  }\n\n  init.start()\n}\n"],"names":["naturalSort","require","getByClass","extend","indexOf","events","toString","classes","getAttribute","toArray","templater","Item","sort","sortButtons","addSortListeners","clearSortOrder","setSortOrder","module","exports","id","options","values","init","self","this","addAsync","initPagination","start","listClass","searchClass","sortClass","page","i","items","visibleItems","matchingItems","searched","filtered","searchColumns","searchDelay","handlers","updated","valueNames","utils","listContainer","document","getElementById","list","parse","template","getTemplate","parentEl","item","search","filter","fuzzySearch","pagination","update","handler","on","add","il","length","sortFunction","alphabet","before","trigger","after","sortStart","sortComplete","valueName","order","reIndex","toJSON","json","push","callback","slice","added","show","remove","value","found","elm","splice","get","matchedItems","size","clear","event","off","e","index","reset","is","matching","create"],"mappings":"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"}